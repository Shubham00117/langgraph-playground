<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resume Chat Feature â€” LangGraph + Streamlit</title>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&family=Outfit:wght@300;400;600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #07070e;
            --card: #0e0e1c;
            --border: #181828;
            --accent: #6c63ff;
            --green: #00dfa2;
            --yellow: #ffd166;
            --blue: #4cc9f0;
            --pink: #f72585;
            --orange: #ff8c42;
            --text: #dde1f0;
            --muted: #52527a;
            --code-bg: #060610;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Outfit', sans-serif;
            padding: 36px 20px 80px;
            line-height: 1.65;
        }

        .page {
            max-width: 880px;
            margin: 0 auto;
        }

        /* HEADER */
        .header {
            margin-bottom: 44px;
            padding-bottom: 28px;
            border-bottom: 1px solid var(--border);
        }

        .badge {
            display: inline-block;
            background: rgba(108, 99, 255, .15);
            border: 1px solid rgba(108, 99, 255, .4);
            color: var(--accent);
            font-size: 11px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            padding: 4px 12px;
            border-radius: 99px;
            margin-bottom: 14px;
        }

        h1 {
            font-size: 34px;
            font-weight: 800;
            color: #fff;
            margin-bottom: 6px;
        }

        h1 span {
            color: var(--accent);
        }

        .sub {
            color: var(--muted);
            font-size: 14px;
        }

        /* SECTION */
        .section {
            margin-bottom: 36px;
        }

        .sec-label {
            font-size: 10.5px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .sec-label::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        /* CARD */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 18px 22px;
            margin-bottom: 12px;
        }

        .card-title {
            font-size: 14px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card p {
            font-size: 13.5px;
            color: var(--muted);
            margin-bottom: 8px;
        }

        .card p:last-child {
            margin-bottom: 0;
        }

        /* CODE */
        pre {
            background: var(--code-bg);
            border: 1px solid #12122a;
            border-radius: 8px;
            padding: 14px 18px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12.5px;
            line-height: 1.8;
            color: #a8b0d0;
            margin-top: 10px;
        }

        .kw {
            color: #c792ea;
        }

        .fn {
            color: #82aaff;
        }

        .str {
            color: #c3e88d;
        }

        .cm {
            color: #333355;
            font-style: italic;
        }

        .hi {
            color: var(--green);
        }

        .num {
            color: #f78c6c;
        }

        .dec {
            color: var(--yellow);
        }

        /* GRID */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media(max-width:640px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }
        }

        /* TAG */
        .tag {
            display: inline-block;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11.5px;
            padding: 2px 8px;
            border-radius: 4px;
            border: 1px solid var(--border);
            margin: 2px 3px 2px 0;
        }

        .tag-p {
            background: rgba(108, 99, 255, .1);
            color: var(--accent);
            border-color: rgba(108, 99, 255, .3);
        }

        .tag-g {
            background: rgba(0, 223, 162, .08);
            color: var(--green);
            border-color: rgba(0, 223, 162, .25);
        }

        .tag-b {
            background: rgba(76, 201, 240, .08);
            color: var(--blue);
            border-color: rgba(76, 201, 240, .25);
        }

        .tag-y {
            background: rgba(255, 209, 102, .08);
            color: var(--yellow);
            border-color: rgba(255, 209, 102, .25);
        }

        .tag-r {
            background: rgba(247, 37, 133, .08);
            color: var(--pink);
            border-color: rgba(247, 37, 133, .25);
        }

        /* TIP */
        .tip {
            padding: 10px 14px;
            border-radius: 0 7px 7px 0;
            font-size: 13px;
            margin-top: 10px;
        }

        .tip-g {
            background: #001a10;
            border-left: 3px solid var(--green);
            color: #00a070;
        }

        .tip-y {
            background: #1a1400;
            border-left: 3px solid var(--yellow);
            color: #c8a030;
        }

        .tip-b {
            background: #001522;
            border-left: 3px solid var(--blue);
            color: #38a0c0;
        }

        /* FLOW */
        .flow {
            display: flex;
            flex-direction: column;
        }

        .flow-step {
            display: flex;
            gap: 12px;
            align-items: flex-start;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 13.5px;
            color: var(--muted);
        }

        .flow-step:last-child {
            border-bottom: none;
        }

        .flow-step strong {
            color: var(--text);
        }

        .step-n {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            background: var(--accent);
            color: #fff;
            font-size: 11px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 2px;
        }

        /* STATE TABLE */
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-top: 10px;
        }

        th {
            text-align: left;
            color: var(--muted);
            font-size: 10.5px;
            font-weight: 700;
            letter-spacing: 1px;
            text-transform: uppercase;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border);
        }

        td {
            padding: 9px 12px;
            border-bottom: 1px solid #0f0f1e;
            vertical-align: top;
        }

        td:first-child {
            font-family: 'JetBrains Mono', monospace;
            color: var(--blue);
            font-size: 11.5px;
        }

        td:last-child {
            color: var(--muted);
        }

        tr:last-child td {
            border-bottom: none;
        }
    </style>
</head>

<body>
    <div class="page">

        <!-- HEADER -->
        <div class="header">
            <div class="badge">CampusX Â· Module 14 Â· Resume Chat Feature</div>
            <h1>Resume Chat <span>like ChatGPT</span></h1>
            <p class="sub">Multi-session threading â€” switch between past conversations</p>
        </div>


        <!-- 1. WHAT WE'RE BUILDING -->
        <div class="section">
            <div class="sec-label">Topic 93 â€” Feature Plan</div>
            <div class="card">
                <div class="flow">
                    <div class="flow-step">
                        <div class="step-n">1</div>
                        <div>Sidebar with title + <strong>"New Chat"</strong> button + <strong>"My
                                Conversations"</strong> section</div>
                    </div>
                    <div class="flow-step">
                        <div class="step-n">2</div>
                        <div>Generate a <strong>dynamic thread_id</strong> (UUID) and store it in session_state</div>
                    </div>
                    <div class="flow-step">
                        <div class="step-n">3</div>
                        <div>On <strong>New Chat</strong> click â†’ generate new thread_id, reset message history</div>
                    </div>
                    <div class="flow-step">
                        <div class="step-n">4</div>
                        <div>Maintain a <strong>list of all thread_ids</strong> â€” display each as a clickable sidebar
                            button</div>
                    </div>
                    <div class="flow-step">
                        <div class="step-n">5</div>
                        <div>On click of a thread button â†’ <strong>load that conversation</strong> from LangGraph memory
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- 2. SESSION STATE KEYS -->
        <div class="section">
            <div class="sec-label">Topic 94 â€” Session State Keys (3 Required)</div>
            <div class="card">
                <p>Initialize all three in the Session Setup section â€” guard each with <span class="tag tag-p">not
                        in</span>:</p>
                <table>
                    <tr>
                        <th>Key</th>
                        <th>Type</th>
                        <th>Purpose</th>
                    </tr>
                    <tr>
                        <td>message_history</td>
                        <td style="color:var(--yellow)">list</td>
                        <td>Chat display history for current thread</td>
                    </tr>
                    <tr>
                        <td>thread_id</td>
                        <td style="color:var(--yellow)">str (UUID)</td>
                        <td>Active LangGraph thread â€” links to checkpointer memory</td>
                    </tr>
                    <tr>
                        <td>chat_threads</td>
                        <td style="color:var(--yellow)">list</td>
                        <td>All thread_ids created â€” powers sidebar conversation list</td>
                    </tr>
                </table>
                <pre><span class="cm"># Session Setup â€” run once per session</span>
<span class="kw">if</span> <span class="str">'message_history'</span> <span class="kw">not in</span> st.session_state:
    st.session_state[<span class="str">'message_history'</span>] = []

<span class="kw">if</span> <span class="str">'thread_id'</span> <span class="kw">not in</span> st.session_state:
    st.session_state[<span class="str">'thread_id'</span>] = <span class="fn">generate_thread_id</span>()

<span class="kw">if</span> <span class="str">'chat_threads'</span> <span class="kw">not in</span> st.session_state:
    st.session_state[<span class="str">'chat_threads'</span>] = []</pre>
            </div>
        </div>


        <!-- 3. UTILITY FUNCTIONS -->
        <div class="section">
            <div class="sec-label">Topic 95 â€” Utility Functions</div>
            <div class="grid-2">
                <div class="card">
                    <div class="card-title">generate_thread_id()</div>
                    <p>Creates a unique ID for each conversation using <span class="tag tag-b">uuid.uuid4()</span>.</p>
                    <pre><span class="kw">import</span> uuid

<span class="kw">def</span> <span class="fn">generate_thread_id</span>():
    thread_id = uuid.<span class="fn">uuid4</span>()
    <span class="kw">return</span> thread_id</pre>
                </div>
                <div class="card">
                    <div class="card-title">add_thread(thread_id)</div>
                    <p>Adds a thread_id to the sidebar list â€” prevents duplicates with <span class="tag tag-b">not
                            in</span> guard.</p>
                    <pre><span class="kw">def</span> <span class="fn">add_thread</span>(thread_id):
    <span class="kw">if</span> thread_id <span class="kw">not in</span> \
    st.session_state[<span class="str">'chat_threads'</span>]:
        st.session_state[<span class="str">'chat_threads'</span>]\
            .<span class="fn">append</span>(thread_id)</pre>
                </div>
            </div>
            <div class="card">
                <div class="card-title">reset_chat() â€” New Chat handler</div>
                <p>Called when user clicks "New Chat". Generates a fresh thread, registers it, and clears display
                    history.</p>
                <pre><span class="kw">def</span> <span class="fn">reset_chat</span>():
    thread_id = <span class="fn">generate_thread_id</span>()
    st.session_state[<span class="str">'thread_id'</span>] = thread_id
    <span class="fn">add_thread</span>(thread_id)                        <span class="cm"># register in sidebar list</span>
    st.session_state[<span class="str">'message_history'</span>] = []   <span class="cm"># clear chat display</span></pre>
                <div class="tip tip-y">âš ï¸ Note: LangGraph's <code>InMemorySaver</code> checkpointer still holds the old
                    conversation in memory under the old thread_id â€” that's how resume works. <code>reset_chat()</code>
                    only switches the active thread.</div>
            </div>
        </div>


        <!-- 4. SIDEBAR UI -->
        <div class="section">
            <div class="sec-label">Topic 96 â€” Sidebar UI</div>
            <div class="card">
                <div class="card-title">Complete sidebar structure</div>
                <pre><span class="cm"># â”€â”€ Sidebar UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
st.sidebar.<span class="fn">title</span>(<span class="str">'LangGraph Chatbot'</span>)

<span class="cm"># New Chat button â†’ triggers reset_chat()</span>
<span class="kw">if</span> st.sidebar.<span class="fn">button</span>(<span class="str">'New Chat'</span>):
    <span class="fn">reset_chat</span>()

st.sidebar.<span class="fn">header</span>(<span class="str">'My Conversations'</span>)

<span class="cm"># List all threads as clickable buttons</span>
<span class="kw">for</span> thread_id <span class="kw">in</span> st.session_state[<span class="str">'chat_threads'</span>]:
    <span class="kw">if</span> st.sidebar.<span class="fn">button</span>(<span class="fn">str</span>(thread_id)):   <span class="cm"># convert UUID to str!</span>
        <span class="cm"># Switch to this thread</span>
        st.session_state[<span class="str">'thread_id'</span>] = thread_id
        messages = <span class="fn">load_conversation</span>(thread_id)
        <span class="cm"># convert LangChain messages â†’ display format</span>
        ...</pre>
                <div class="tip tip-b">ğŸ’¡ <code>str(thread_id)</code> is required â€” Streamlit's button label must be a
                    string, but <code>uuid.uuid4()</code> returns a UUID object. Passing a non-string raises a
                    <code>TypeError</code>.
                </div>
            </div>
        </div>


        <!-- 5. LOAD CONVERSATION -->
        <div class="section">
            <div class="sec-label">Topic 97 â€” Load Conversation (Resume Chat)</div>
            <div class="card">
                <div class="card-title">Fetch past messages from LangGraph checkpointer</div>
                <p>LangGraph stores full message history per thread_id in the checkpointer. Retrieve it, then convert
                    from LangChain message objects to <span class="tag tag-p">{'role', 'content'}</span> dicts for
                    Streamlit display.</p>
                <pre><span class="kw">def</span> <span class="fn">load_conversation</span>(thread_id):
    config = {<span class="str">'configurable'</span>: {<span class="str">'thread_id'</span>: thread_id}}
    state  = chatbot.<span class="fn">get_state</span>(config)
    <span class="kw">return</span> state.values.get(<span class="str">'messages'</span>, [])

<span class="cm"># When a thread button is clicked:</span>
messages = <span class="fn">load_conversation</span>(thread_id)

temp_messages = []
<span class="kw">for</span> msg <span class="kw">in</span> messages:
    <span class="kw">if</span> <span class="fn">isinstance</span>(msg, HumanMessage):
        role = <span class="str">'user'</span>
    <span class="kw">else</span>:
        role = <span class="str">'assistant'</span>
    temp_messages.<span class="fn">append</span>({<span class="str">'role'</span>: role, <span class="str">'content'</span>: msg.content})

<span class="cm"># Replace session message history with loaded conversation</span>
st.session_state[<span class="str">'message_history'</span>] = temp_messages
st.session_state[<span class="str">'thread_id'</span>] = thread_id</pre>
                <div class="tip tip-g">âœ… <code>isinstance(msg, HumanMessage)</code> distinguishes user vs AI messages.
                    LangGraph stores them as LangChain objects â€” convert to plain dicts for Streamlit rendering.</div>
            </div>
        </div>


        <!-- 6. DYNAMIC CONFIG + STREAMING -->
        <div class="section">
            <div class="sec-label">Topic 98 â€” Dynamic CONFIG + Streaming</div>
            <div class="card">
                <div class="card-title">Use session thread_id in every chatbot call</div>
                <p>CONFIG must be built from the <strong>current</strong> session thread_id (not hardcoded) so each
                    conversation is isolated in the LangGraph checkpointer.</p>
                <pre><span class="cm"># Build CONFIG dynamically from active thread</span>
CONFIG = {<span class="str">'configurable'</span>: {<span class="str">'thread_id'</span>: st.session_state[<span class="str">'thread_id'</span>]}}

<span class="cm"># Stream response using dynamic CONFIG</span>
<span class="kw">with</span> st.<span class="fn">chat_message</span>(<span class="str">'assistant'</span>):
    ai_message = st.<span class="fn">write_stream</span>(
        message_chunk.content
        <span class="kw">for</span> message_chunk, metadata <span class="kw">in</span> chatbot.<span class="fn">stream</span>(
            {<span class="str">'messages'</span>: [<span class="fn">HumanMessage</span>(content=user_input)]},
            config=CONFIG,
            stream_mode=<span class="str">'messages'</span>
        )
    )

st.session_state[<span class="str">'message_history'</span>].<span class="fn">append</span>(
    {<span class="str">'role'</span>: <span class="str">'assistant'</span>, <span class="str">'content'</span>: ai_message}
)</pre>
            </div>
        </div>


        <!-- 7. FULL APP STRUCTURE -->
        <div class="section">
            <div class="sec-label">Topic 99 â€” Full File Structure</div>
            <div class="card">
                <pre><span class="cm"># â”€â”€ Imports â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kw">import</span> streamlit <span class="kw">as</span> st
<span class="kw">import</span> uuid
<span class="kw">from</span> langgraph_backend <span class="kw">import</span> chatbot
<span class="kw">from</span> langchain_core.messages <span class="kw">import</span> HumanMessage

<span class="cm"># â”€â”€ Utility Functions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="kw">def</span> <span class="fn">generate_thread_id</span>(): ...
<span class="kw">def</span> <span class="fn">reset_chat</span>(): ...
<span class="kw">def</span> <span class="fn">add_thread</span>(thread_id): ...
<span class="kw">def</span> <span class="fn">load_conversation</span>(thread_id): ...

<span class="cm"># â”€â”€ Session Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="cm"># Initialize message_history, thread_id, chat_threads</span>
<span class="fn">add_thread</span>(st.session_state[<span class="str">'thread_id'</span>])  <span class="cm"># register first thread</span>

<span class="cm"># â”€â”€ Sidebar UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="cm"># Title â†’ New Chat button â†’ My Conversations â†’ thread buttons</span>

<span class="cm"># â”€â”€ Main UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span>
<span class="cm"># Render message_history â†’ chat_input â†’ handle input â†’ stream response</span></pre>
            </div>

            <!-- Quick Reference -->
            <div class="card" style="border-color: rgba(108,99,255,.3); margin-top:0;">
                <div class="card-title" style="color:var(--accent)">âš¡ Key Points to Remember</div>
                <table>
                    <tr>
                        <th>Concept</th>
                        <th>Key Detail</th>
                    </tr>
                    <tr>
                        <td>uuid.uuid4()</td>
                        <td>Generates a unique thread ID per conversation</td>
                    </tr>
                    <tr>
                        <td>str(thread_id)</td>
                        <td>Must cast UUID â†’ str for st.sidebar.button()</td>
                    </tr>
                    <tr>
                        <td>chat_threads list</td>
                        <td>Stores all thread IDs â†’ powers sidebar list</td>
                    </tr>
                    <tr>
                        <td>reset_chat()</td>
                        <td>New thread_id + add_thread() + clear message_history</td>
                    </tr>
                    <tr>
                        <td>load_conversation()</td>
                        <td>chatbot.get_state(config).values['messages']</td>
                    </tr>
                    <tr>
                        <td>isinstance(msg, HumanMessage)</td>
                        <td>Converts LangChain objects â†’ role/content dicts</td>
                    </tr>
                    <tr>
                        <td>CONFIG (dynamic)</td>
                        <td>Built from st.session_state['thread_id'] each time</td>
                    </tr>
                    <tr>
                        <td>InMemorySaver</td>
                        <td>Holds all threads in RAM â€” lost on server restart</td>
                    </tr>
                </table>
            </div>
        </div>

    </div>
</body>

</html>