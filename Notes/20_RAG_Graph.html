<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LangGraph — RAG Graph Workflow</title>
    <link
        href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --bg: #0d0f14;
            --surface: #13161d;
            --border: #1e2230;
            --accent1: #00e5ff;
            --accent2: #7c6af7;
            --accent3: #ff6b6b;
            --accent4: #39d98a;
            --text: #c8d0e0;
            --muted: #5a6580;
            --heading: #edf0f7;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: var(--bg);
            color: var(--text);
            font-family: 'Syne', sans-serif;
            min-height: 100vh;
            padding: 40px 20px 80px;
        }

        .grid-bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            background-image:
                linear-gradient(rgba(0, 229, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 229, 255, 0.03) 1px, transparent 1px);
            background-size: 40px 40px;
            pointer-events: none;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 60px;
            animation: fadeDown 0.6s ease both;
        }

        header .tag {
            display: inline-block;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--accent1);
            border: 1px solid var(--accent1);
            padding: 4px 14px;
            border-radius: 2px;
            margin-bottom: 16px;
            opacity: 0.8;
        }

        header h1 {
            font-size: clamp(2rem, 5vw, 3.2rem);
            font-weight: 800;
            color: var(--heading);
            line-height: 1.1;
            letter-spacing: -1px;
        }

        header h1 span {
            color: var(--accent1);
        }

        header p {
            margin-top: 12px;
            color: var(--muted);
            font-size: 15px;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Section */
        .section {
            margin-bottom: 40px;
            animation: fadeUp 0.5s ease both;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .section-num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--muted);
            width: 28px;
        }

        .section-title {
            font-size: 13px;
            font-weight: 700;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--accent1);
        }

        .section-line {
            flex: 1;
            height: 1px;
            background: var(--border);
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 24px 28px;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
        }

        .card.c1::before {
            background: var(--accent1);
        }

        .card.c2::before {
            background: var(--accent2);
        }

        .card.c3::before {
            background: var(--accent4);
        }

        .card.c4::before {
            background: var(--accent3);
        }

        .card h2 {
            font-size: 17px;
            font-weight: 700;
            color: var(--heading);
            margin-bottom: 12px;
        }

        .card p {
            font-size: 14px;
            line-height: 1.7;
            color: var(--text);
            margin-bottom: 8px;
        }

        .card p:last-child {
            margin-bottom: 0;
        }

        /* Flow diagram */
        .flow {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            margin: 16px 0;
        }

        .flow-node {
            background: #0d0f14;
            border: 1px solid var(--accent1);
            color: var(--accent1);
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            padding: 6px 14px;
            border-radius: 4px;
            white-space: nowrap;
        }

        .flow-node.special {
            border-color: var(--accent2);
            color: var(--accent2);
        }

        .flow-node.end {
            border-color: var(--accent3);
            color: var(--accent3);
        }

        .arrow {
            color: var(--muted);
            font-size: 16px;
        }

        /* Code block */
        pre {
            background: #080a0f;
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 18px 20px;
            overflow-x: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 12.5px;
            line-height: 1.65;
            margin: 12px 0;
            color: #a8b4cc;
        }

        .kw {
            color: #7c6af7;
        }

        .fn {
            color: #00e5ff;
        }

        .str {
            color: #39d98a;
        }

        .cm {
            color: #3d4a66;
            font-style: italic;
        }

        .nb {
            color: #ff9f43;
        }

        /* Pills */
        .pills {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .pill {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            padding: 3px 10px;
            border-radius: 20px;
            border: 1px solid;
        }

        .pill.blue {
            color: var(--accent1);
            border-color: var(--accent1);
            background: rgba(0, 229, 255, 0.07);
        }

        .pill.purple {
            color: var(--accent2);
            border-color: var(--accent2);
            background: rgba(124, 106, 247, 0.07);
        }

        .pill.green {
            color: var(--accent4);
            border-color: var(--accent4);
            background: rgba(57, 217, 138, 0.07);
        }

        .pill.red {
            color: var(--accent3);
            border-color: var(--accent3);
            background: rgba(255, 107, 107, 0.07);
        }

        /* Steps list */
        .steps {
            list-style: none;
            margin-top: 12px;
        }

        .steps li {
            display: flex;
            gap: 14px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
            font-size: 14px;
            line-height: 1.5;
        }

        .steps li:last-child {
            border-bottom: none;
        }

        .step-num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--accent2);
            min-width: 22px;
            padding-top: 2px;
        }

        /* Two col */
        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 600px) {
            .two-col {
                grid-template-columns: 1fr;
            }
        }

        /* Highlight box */
        .highlight {
            background: rgba(0, 229, 255, 0.05);
            border: 1px solid rgba(0, 229, 255, 0.2);
            border-radius: 6px;
            padding: 14px 18px;
            margin-top: 12px;
            font-size: 13px;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent1);
            line-height: 1.6;
        }

        @keyframes fadeDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: none;
            }
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: none;
            }
        }

        .section:nth-child(1) {
            animation-delay: 0.1s;
        }

        .section:nth-child(2) {
            animation-delay: 0.2s;
        }

        .section:nth-child(3) {
            animation-delay: 0.3s;
        }

        .section:nth-child(4) {
            animation-delay: 0.4s;
        }
    </style>
</head>

<body>
    <div class="grid-bg"></div>
    <div class="container">

        <header style="border-left: 3px solid var(--accent1); padding-left: 20px; margin-bottom: 48px;">
            <div class="badge"
                style="background: var(--accent1); color: #000; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 700; display: inline-block; margin-bottom: 12px; text-transform: uppercase; letter-spacing: 0.1em;">
                CampusX · Module 20 · RAG Graph Workflow</div>
            <h1>RAG Agent Graph in LangGraph</h1>
            <p style="color: var(--muted); font-size: 0.95rem; margin-top: 8px;">// MessageGraph · ToolNode ·
                Conditional Edges</p>
        </header>

        <!-- 1. Graph Anatomy -->
        <div class="section">
            <div class="section-header">
                <span class="section-num">01</span>
                <span class="section-title">Topic 140. Graph Anatomy</span>
                <div class="section-line"></div>
            </div>
            <div class="card c1">
                <h2>How the RAG workflow is structured</h2>
                <div class="flow">
                    <span class="flow-node special">START</span>
                    <span class="arrow">→</span>
                    <span class="flow-node">agent</span>
                    <span class="arrow">↔</span>
                    <span class="flow-node end">tools</span>
                </div>

                <div class="mermaid" style="display: flex; justify-content: center; margin: 20px 0;">
                    ---
                    config:
                    flowchart:
                    curve: linear
                    ---
                    graph TD;
                    __start__([__start__]):::first
                    agent(agent)
                    tools(tools)
                    __end__([__end__]):::last
                    __start__ --> agent;
                    agent -.-> __end__;
                    agent -.-> tools;
                    tools --> agent;
                    classDef default fill:#13161d,stroke:#00e5ff,stroke-width:1px,color:#edf0f7
                    classDef first fill:#13161d,stroke:#7c6af7,stroke-width:1px,color:#7c6af7
                    classDef last fill:#13161d,stroke:#ff6b6b,stroke-width:1px,color:#ff6b6b
                </div>
                <ul class="steps">
                    <li><span class="step-num">①</span><span><strong>MessageGraph:</strong> The core state container
                            representing the sequence of conversational messages.</span></li>
                    <li><span class="step-num">②</span><span><strong>agent (Node):</strong> Invokes the LLM to either
                            answer the user or call a tool based on the conversation history.</span></li>
                    <li><span class="step-num">③</span><span><strong>tools (Node):</strong> Executes the requested tool
                            (like a Retrieval Tool) and passes its result back to the agent.</span></li>
                    <li><span class="step-num">④</span><span><strong>tools_condition (Edge):</strong> Conditional
                            routing; loops to `tools` if LLM requests it, else finishes execution.</span></li>
                </ul>
                <div class="pills">
                    <span class="pill blue">MessageGraph</span>
                    <span class="pill purple">ToolNode</span>
                    <span class="pill green">tools_condition</span>
                </div>
            </div>
        </div>

        <!-- 2. Implementation -->
        <div class="section">
            <div class="section-header">
                <span class="section-num">02</span>
                <span class="section-title">Topic 141. Building the Graph</span>
                <div class="section-line"></div>
            </div>
            <div class="card c2">
                <h2>Defining Nodes & Edges</h2>
                <pre><span class="kw">from</span> langgraph.graph <span class="kw">import</span> START, MessageGraph
<span class="kw">from</span> langgraph.prebuilt <span class="kw">import</span> ToolNode, tools_condition

<span class="cm"># 1. Provide LLM with tools</span>
llm = <span class="fn">ChatGroq</span>(model=<span class="str">"llama-3.3-70b-versatile"</span>).bind_tools([rag_tool])

<span class="cm"># 2. Add Nodes</span>
builder = <span class="fn">MessageGraph</span>()
builder.add_node(<span class="str">"agent"</span>, <span class="kw">lambda</span> state: llm.invoke(state))
builder.add_node(<span class="str">"tools"</span>, <span class="fn">ToolNode</span>([rag_tool]))

<span class="cm"># 3. Add Edges</span>
builder.add_edge(START, <span class="str">"agent"</span>)
builder.add_conditional_edges(<span class="str">"agent"</span>, tools_condition)
builder.add_edge(<span class="str">"tools"</span>, <span class="str">"agent"</span>)

<span class="cm"># 4. Compile</span>
rag_app = builder.compile()</pre>
            </div>
        </div>

        <!-- 3. Invocation & Streaming -->
        <div class="section">
            <div class="section-header">
                <span class="section-num">03</span>
                <span class="section-title">Topic 142. Execution</span>
                <div class="section-line"></div>
            </div>
            <div class="card c4">
                <h2>Streaming Values</h2>
                <pre><span class="kw">from</span> langchain_core.messages <span class="kw">import</span> HumanMessage

inputs = [HumanMessage(content=<span class="str">"What is Multi-head attention?"</span>)]

<span class="cm"># Stream events to observe intermediate graph steps and final response</span>
<span class="kw">for</span> event <span class="kw">in</span> rag_app.stream(inputs, stream_mode=<span class="str">"values"</span>):
    message = event[-<span class="nb">1</span>] <span class="cm"># Get the latest message generated in state</span>
    <span class="kw">if</span> message.type == <span class="str">"ai"</span> <span class="kw">and</span> message.content:
        <span class="nb">print</span>(f<span class="str">"Agent: {message.content}"</span>)</pre>
            </div>
        </div>

        <!-- 4. Key Takeaways -->
        <div class="section">
            <div class="section-header">
                <span class="section-num">04</span>
                <span class="section-title">Topic 143. Key Takeaways</span>
                <div class="section-line"></div>
            </div>
            <div class="two-col">
                <div class="card c1" style="padding:18px 20px;">
                    <h2 style="font-size:14px;margin-bottom:10px;">Prebuilt Components</h2>
                    <p style="font-size:13px;">LangGraph provides <code>ToolNode</code> and <code>tools_condition</code>
                        to quickly structure your tool-calling loops without writing boilerplate node functions.</p>
                </div>
                <div class="card c3" style="padding:18px 20px;">
                    <h2 style="font-size:14px;margin-bottom:10px;">Cyclic Flow</h2>
                    <p style="font-size:13px;">The agent dictates when to call a tool and when to end based on
                        <code>tools_condition</code> and cyclic <code>tools → agent</code> edges.
                    </p>
                </div>
            </div>
            <div class="highlight" style="margin-top:16px;">
                START → agent → tools_condition (has_tool_calls?) → tools/END
            </div>
        </div>

    </div>

    <!-- Mermaid JS for graphing -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true, theme: 'dark' });
    </script>
</body>

</html>